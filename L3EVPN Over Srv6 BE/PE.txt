Step 1: Configure Interfaces
Description: This initial step involves setting up the device's network interfaces. The Loopback interface is configured to provide a stable address for BGP peering and SRv6 identification. The core-facing interface establishes connectivity with the provider network, while the CE-facing interface connects to the customer's network and is assigned to a specific VPN.

JSON Example:

JSON

{
  "interfaces": {
    "Loopback1": {
      "description": "Stable address for BGP peering and SRv6 Source",
      "ipv6_enable": true,
      "ipv6_address": {
        "address": "${loopback_ipv6_address}",
        "prefix_length": "${loopback_ipv6_prefix}"
      }
    },
    "${core_interface_name}": {
      "description": "Core-facing interface to connect to P router",
      "ipv6_enable": true,
      "ipv6_address": {
        "address": "${core_interface_ipv6_address}",
        "prefix_length": "${core_interface_ipv6_prefix}"
      }
    },
    "${ce_interface_name}": {
      "description": "CE-facing interface bound to the customer VPN",
      "vpn_binding": "${vpn_name}",
      "ip_address": {
        "address": "${ce_interface_ipv4_address}",
        "prefix_length": "${ce_interface_ipv4_prefix}"
      }
    }
  }
}
Step 2: Configure VPN Instance (VRF)
Description: A VPN instance (or VRF) is created to isolate the customer's traffic and routing table from the global table. The Route Distinguisher (RD) ensures that the customer's routes are unique within the BGP domain, while the VPN Target (RT) controls which routes are imported into and exported from this VPN instance.

JSON Example:

JSON

{
  "vpn_instances": [
    {
      "name": "${vpn_name}",
      "ipv4_family": {
        "route_distinguisher": "${rd_value}",
        "vpn_target": {
          "value": "${rt_value}",
          "type": "evpn"
        }
      }
    }
  ]
}
Step 3: Configure Underlay IGP (IS-IS)
Description: The IS-IS protocol is configured as the underlay routing protocol to provide reachability within the core network. It is enabled for IPv6 to exchange the necessary prefixes for the SRv6 data plane to function correctly.

JSON Example:

JSON

{
  "routing": {
    "isis": {
      "process_id": "${isis_process_id}",
      "level": "level-1",
      "cost_style": "wide",
      "network_entity": "${net_entity}",
      "enabled_on_interfaces": [
        "${core_interface_name}",
        "Loopback1"
      ]
    }
  }
}
Step 4: Configure BGP and EVPN
Description: BGP is configured to manage both customer routes and VPN service information. An iBGP session is established with the remote PE for the l2vpn-family evpn to exchange VPN membership and route information. An eBGP session is configured within the VRF context to peer with the customer's CE device and learn its local routes.

JSON Example:

JSON

{
  "bgp": {
    "as_number": "${bgp_as_number}",
    "router_id": "${bgp_router_id}",
    "iBGP_peer_evpn": {
      "address": "${remote_pe_address}",
      "remote_as": "${bgp_as_number}",
      "update_source": "${update_source}}}",
      "address_families_enabled": [
        "l2vpn_evpn"
      ]
    },
    "vrf_config": {
      "name": "${vpn_name}",
      "eBGP_peer_customer": {
        "address": "${ce_peer_address}",
        "remote_as": "${ce_as_number}"
      },
      "advertise_l2vpn_evpn": true
    }
  }
}
Step 5: Configure Segment Routing (SRv6)
Description: SRv6 is enabled to create the data plane transport over the IPv6 underlay. A locator is defined, which is a specific IPv6 prefix assigned to this PE for generating Segment IDs (SIDs). An End.DT4 service SID is created to instruct the PE to decapsulate SRv6 packets and perform a lookup in the specified VPN routing table. This SRv6 capability is then advertised in IS-IS and BGP.

JSON Example:

JSON

{
  "segment_routing_v6": {
    "encapsulation_source_address": "${loopback_ipv6_address}",
    "locators": [
      {
        "name": "${locator_name}",
        "prefix": {
          "address": "${locator_prefix_address}",
          "prefix_length": "${locator_prefix_length}"
        },
        "service_sids": [
          {
            "opcode": "${opcode_sid}",
            "function": "end-dt4",
            "vpn_instance": "${vpn_name}"
          }
        ]
      }
    ]
  },
  "isis_advertisement": {
    "process_id": "${isis_process_id}",
    "advertise_srv6_locator": "${locator_name}"
  },
  "bgp_advertisement": {
    "as_number": "${bgp_as_number}",
    "vrf_name": "${vpn_name}",
    "activate_srv6_for_evpn": {
      "locator": "${locator_name}",
      "policy": "best-effort"
    }
  }
}